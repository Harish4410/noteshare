{% extends "base.html" %}
{% block content %}

<h2>ğŸ’¬ Group Chat</h2>

<div id="chat-box" style="height:300px; overflow-y:scroll; border:1px solid #ccc; padding:10px;">
</div>

<form id="chat-form">
    <input type="text" id="message" placeholder="Type message..." required>
    <button type="submit">Send</button>
</form>

<script>
const groupId = {{ group_id }};

function loadMessages() {
    fetch(`/get_messages/${groupId}`)
        .then(res => res.json())
        .then(data => {
            const chatBox = document.getElementById("chat-box");
            chatBox.innerHTML = "";
            data.forEach(msg => {
                chatBox.innerHTML += `
                    <p><strong>${msg.name}</strong>: ${msg.message}
                    <br><small>${msg.created_at}</small></p>
                `;
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        });
}

document.getElementById("chat-form").addEventListener("submit", function(e){
    e.preventDefault();
    const message = document.getElementById("message").value;

    fetch(`/send_message/${groupId}`, {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: `message=${message}`
    }).then(() => {
        document.getElementById("message").value = "";
        loadMessages();
    });
});

setInterval(loadMessages, 2000);
loadMessages();
</script>

{% endblock %}